
# Test 1
get [expect 1]: 1
get on other thread [expect 1]: 1
get on earlier thread [expect 1]: 1

# Test 2
with_temporarily [expect 8]: 8
In other thread during with_temporarily [expect 7]: 7
with_temporarily still [expect 8]: 8
after with_temporarily [expect 7]: 7

# Test 3
In fiber [expect 20]: 20
In pre-existing thread [expect 30]: 30
in handler [expect 20]: 20
with_temporarily [expect 22]: 22
In other thread during with_temporarily [expect 30]: 30
with_temporarily still [expect 22]: 22
after with_temporarily [expect 20]: 20
In pre-existing thread [expect 30]: 30
In continuation [expect 21]: 21
after fiber [expect 23]: 23
In pre-existing thread [expect 30]: 30
after continuation [expect 23]: 23
In pre-existing thread [expect 30]: 30

# Test 4
In fiber [expect 40]: 40
In pre-existing thread [expect 50]: 50
with_temporarily in fiber [expect 41]: 41
in handler [expect 40]: 40
continuing in with_temporarily [expect 41]: 41
still in continuation, after with_temporarily [expect 43]: 43
after fiber [expect 43]: 43
In pre-existing thread [expect 50]: 50
with_temporarily [expect 45]: 45
In other thread during with_temporarily [expect 50]: 50
with_temporarily still [expect 45]: 45
after with_temporarily [expect 43]: 43
after continuation returns [expect 43]: 43
In pre-existing thread [expect 50]: 50
